import React, { useEffect } from "react";
import Plotly from "plotly.js/dist/plotly";
import Plot from "react-plotly.js";
import { usePageContext } from "../context/PageContext";
import { useResizeDetector } from "react-resize-detector";

function StockChart() {
  const { marker, setMarker } = usePageContext();
  const { width, height, ref } = useResizeDetector();
  let x = [
    "2014-01-02",
    "2014-01-03",
    "2014-01-06",
    "2014-01-07",
    "2014-01-08",
    "2014-01-09",
    "2014-01-10",
    "2014-01-13",
    "2014-01-14",
    "2014-01-15",
    "2014-01-16",
    "2014-01-17",
    "2014-01-21",
    "2014-01-22",
    "2014-01-23",
    "2014-01-24",
    "2014-01-27",
    "2014-01-28",
    "2014-01-29",
    "2014-01-30",
    "2014-01-31",
    "2014-02-03",
    "2014-02-04",
    "2014-02-05",
    "2014-02-06",
    "2014-02-07",
    "2014-02-10",
    "2014-02-11",
    "2014-02-12",
    "2014-02-13",
    "2014-02-14",
    "2014-02-18",
    "2014-02-19",
    "2014-02-20",
    "2014-02-21",
    "2014-02-24",
    "2014-02-25",
    "2014-02-26",
    "2014-02-27",
    "2014-02-28",
    "2014-03-03",
    "2014-03-04",
    "2014-03-05",
    "2014-03-06",
    "2014-03-07",
    "2014-03-10",
    "2014-03-11",
    "2014-03-12",
    "2014-03-13",
    "2014-03-14",
    "2014-03-17",
    "2014-03-18",
    "2014-03-19",
    "2014-03-20",
    "2014-03-21",
    "2014-03-24",
    "2014-03-25",
    "2014-03-26",
    "2014-03-27",
    "2014-03-28",
    "2014-03-31",
    "2014-04-01",
    "2014-04-02",
    "2014-04-03",
    "2014-04-04",
    "2014-04-07",
    "2014-04-08",
    "2014-04-09",
    "2014-04-10",
    "2014-04-11",
    "2014-04-14",
    "2014-04-15",
    "2014-04-16",
    "2014-04-17",
    "2014-04-21",
    "2014-04-22",
    "2014-04-23",
    "2014-04-24",
    "2014-04-25",
    "2014-04-28",
    "2014-04-29",
    "2014-04-30",
    "2014-05-01",
    "2014-05-02",
    "2014-05-05",
    "2014-05-06",
    "2014-05-07",
    "2014-05-08",
    "2014-05-09",
    "2014-05-12",
    "2014-05-13",
    "2014-05-14",
    "2014-05-15",
    "2014-05-16",
    "2014-05-19",
    "2014-05-20",
    "2014-05-21",
    "2014-05-22",
    "2014-05-23",
    "2014-05-27",
  ];
  let y = [
    77.44539475, 77.04557544, 74.89697204, 75.856461, 75.09194679, 76.20263178,
    75.2301837, 73.84891755, 75.0113527, 77.14481412, 77.33058367, 76.85652616,
    75.39394758, 76.7763823, 76.64038513, 77.20512022, 76.66007339, 70.90497216,
    70.23598702, 70.03463724, 69.00470795, 70.04050186, 70.50025256, 70.599595,
    71.50652865, 73.09834283, 72.71181988, 74.38994589, 75.2743945, 74.9602296,
    76.05688873, 76.55140204, 76.37468597, 74.7279776, 74.69710728, 73.34314093,
    74.21622457, 73.40762211, 72.50368071, 74.17817422, 73.38154805,
    74.44635193, 74.43810354, 74.69600358, 74.46113283, 74.07111203,
    75.07027178, 74.93559065, 75.35199472, 74.13480798, 73.98459392, 73.7289236,
    74.62019501, 74.28682958, 74.57820913, 75.48205234, 75.92068662,
    76.62498351, 75.70890299, 75.47469806, 75.5990936, 75.39461719, 76.03616773,
    75.90452792, 75.68018051, 74.02790571, 73.62532898, 73.27327651,
    74.39941392, 72.7644772, 73.1708442, 72.94387096, 72.62541762, 72.897474,
    73.65263437, 74.06474967, 74.17426241, 79.66168695, 79.14119558,
    80.30519282, 83.23767089, 83.08750733, 82.99289917, 83.04635189,
    82.73311868, 84.3659999, 83.449361, 82.92665266, 82.40901903, 82.82714134,
    83.46187012, 83.516998, 83.83894399, 82.98805242, 84.28974015, 85.22180467,
    85.13035972, 85.51554663, 85.61005813, 86.82546553
  ];
  useEffect(() => {
    let frames = [];

    for (let i = 0; i < 100; i++) {
      frames[i] = { data: [{ x: [], y: [] }] };
      frames[i].data[0].x = x.slice(0, i + 1);
      frames[i].data[0].y = y.slice(0, i + 1);
    }

    const annotationStyle = {
        fontFamily: "Nanum Myeongjo",
        fontSize: width > 500 ? 0.04 * width : 0.085 * height,
        color: "white",
        cursor: "pointer",
        textDecoration: "underline",
      };

    let layout = {
      plot_bgcolor: "#f0f0f0",
      paper_bgcolor: "#f0f0f0",
      margin: {
        r: 0,
        t: 0,
        b: 0,
        l: 20,
      },
      annotations: [
        {
            onclick:()=>console.log('sdf'),
          showarrow: false,
          text: "FIND OUT MY SKILLS",
          font: {
            family: "Montserrat Subrayada",
            size: width > 500 ? 0.04 * width : 0.085 * height,
            color: "white",
            textDecoration:"underline"
          },
          xref: "paper",
          yref: "paper",
          hovertext: "Click!",
          hoverlabel: {
              bgcolor: "white",
              bordercolor: "black",
              color: "black"
          },
          x: 0.5,
          y: 0.2,
        },
      ],
      width: 0.95 * window.innerWidth,
      xaxis: {
        color: "black",
        tickfont: { color: "black" },
        ticks: "inside",
        automargin: true,
        showgrid: false,
        tickformat: '%d %b'
      },
      yaxis: {
        color: "black",
        titlefont: { color: "black" },
        showgrid: false,
      },
    };
    let config = { displayModeBar: false, responsive: true };
    Plotly.newPlot(
      "myDiv",
      [
        {
          x: x,
          y: y,
          fill: "tozeroy",
          type: "lines",
          mode: "lines",
          marker: { color: "green" },
        },
      ],
      layout,
      config
    ).then(function () {
      marker === 4 &&
        Plotly.animate("myDiv", frames, {
          transition: {
            duration: 0,
          },
          frame: {
            duration: 0,
            redraw: false,
          },
        });
    });
  }, [marker, width, height]);

  return (
    <div
      ref={ref}
      className="transition-all ease-in-out duration-400 flex justify-center h-full w-full"
      id="myDiv"
    ></div>
  );
}

export default StockChart;
